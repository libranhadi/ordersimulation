<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Product List</title>
    <script src="https://unpkg.com/vue@3"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="p-5" style="background:#f7f7f7;">
<div id="app" class="container">

    <h2 class="mb-4">Product List</h2>

    <div class="card p-3 mb-4 shadow">
        <h5>Add New Product</h5>

        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Name</label>
                <input v-model="newProduct.name" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Type</label>
                <input v-model="newProduct.type" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label">Price</label>
                <input v-model.number="newProduct.price" type="number" class="form-control">
            </div>
        </div>

        <button @click="createProduct" class="btn btn-primary mt-3">Create Product</button>
    </div>

    <table class="table table-bordered bg-white shadow">
        <thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Price</th>
                <th width="120">Qty</th>
                <th width="150">Action</th>
            </tr>
        </thead>

        <tbody>
            <tr v-for="(p, index) in products" :key="p.id">
                <td>{{ p.name }}</td>
                <td>{{ p.type }}</td>
                <td>Rp {{ format(p.price) }}</td>

                <td>
                    <input type="number" class="form-control" v-model.number="quantities[p.id]" min="1">
                </td>

                <td>
                    <button class="btn btn-success btn-sm"
                            @click="addToCart(p, quantities[p.id])">
                        Add to Cart
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <a href="/cart" class="btn btn-dark mt-4">Go To Cart</a>

</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            products: [],
            quantities: {},
            newProduct: { name: "", type: "", price: 0 }
        };
    },

    mounted() {
        this.loadProducts();
    },

    methods: {
        format(num) { return num.toLocaleString("id-ID"); },

        async loadProducts() {
            const res = await fetch("/api/products");
            const data = await res.json();
            this.products = data.content;

            this.products.forEach(p => this.quantities[p.id] = 1);
        },

        async createProduct() {
            await fetch("/api/products", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(this.newProduct),
            });

            this.newProduct = { name: "", type: "", price: 0 };
            this.loadProducts();
        },

        async addToCart(product, qty) {
            await fetch("/api/cart", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ productId: product.id, qty }),
            });

            alert("Added to cart!");
        }
    }
}).mount("#app");
</script>

</body>
</html>
